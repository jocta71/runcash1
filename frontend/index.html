<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>RunCash</title>
    
    <!-- Solução definitiva para o problema de useLayoutEffect -->
    <script>
      (function() {
        console.log('[Layout Fix] Iniciando correção definitiva para useLayoutEffect');
        
        // 1. Proteção imediata - definir um objeto React global
        window.React = window.React || {};
        
        // 2. Definir useLayoutEffect como uma função segura
        var safeUseLayoutEffect = function(callback, deps) {
          console.log('[Global Fix] Usando implementação segura de useLayoutEffect');
          return function() {};
        };
        
        // 3. Definir a propriedade useLayoutEffect de forma robusta com Object.defineProperty
        if (!window.React.useLayoutEffect) {
          Object.defineProperty(window.React, 'useLayoutEffect', {
            configurable: true,
            enumerable: true,
            writable: true,
            value: safeUseLayoutEffect
          });
        }
        
        // 4. Interceptar erros globais relacionados a useLayoutEffect
        window.addEventListener('error', function(event) {
          if (event && event.error && 
              (String(event.error).includes('useLayoutEffect') || 
               String(event.error).includes('Cannot read properties of undefined'))) {
            console.warn('[Global Interceptor] Erro interceptado:', event.error);
            event.preventDefault();
            return true;
          }
        }, true);
        
        // 5. Interceptar qualquer acesso ao React para garantir que useLayoutEffect exista
        var originalReactModules = {};
        
        // 6. Monkey patch para Object.defineProperty para interceptar definições de React
        var originalDefineProperty = Object.defineProperty;
        Object.defineProperty = function(obj, prop, descriptor) {
          // Se estiver definindo React ou um módulo React
          if (prop === 'React' || 
              (typeof prop === 'string' && prop.includes('react')) ||
              (descriptor && descriptor.value && 
               typeof descriptor.value === 'object' && 
               (descriptor.value.useState || descriptor.value.createElement || descriptor.value.Component))) {
            
            console.log('[Monkey Patch] Interceptando definição de:', prop);
            
            // Guardar o valor original
            var originalValue = descriptor.value;
            
            // Se o valor for um objeto e não tiver useLayoutEffect
            if (originalValue && typeof originalValue === 'object' && !originalValue.useLayoutEffect) {
              // Tentar usar useEffect como base para useLayoutEffect
              if (typeof originalValue.useEffect === 'function') {
                console.log('[Monkey Patch] Usando useEffect como base para useLayoutEffect');
                originalValue.useLayoutEffect = originalValue.useEffect;
              } else {
                // Usar implementação segura como último recurso
                console.log('[Monkey Patch] Usando implementação dummy para useLayoutEffect');
                originalValue.useLayoutEffect = safeUseLayoutEffect;
              }
            }
            
            // Guarda o módulo React para referência futura
            originalReactModules[prop] = originalValue;
          }
          
          return originalDefineProperty.apply(this, arguments);
        };
        
        console.log('[Layout Fix] Proteção definitiva para useLayoutEffect instalada');
      })();
    </script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html> 