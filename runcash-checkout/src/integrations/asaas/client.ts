// Asaas API client for handling subscriptions and payments

// Types for API responses
interface AsaasApiResponse<T> {
  success: boolean
  message?: string
  data?: T
}

interface AsaasSubscriptionResponse {
  subscriptionId: string
  paymentId: string
  status: string
}

interface AsaasPaymentResponse {
  id: string
  status: string
  value: number
  dueDate: string
  invoiceUrl: string
  billingType: string
}

interface AsaasPixResponse {
  encodedImage: string
  payload: {
    encodedImage: string
    expirationDate: string
    payload: string
  }
}

/**
 * Creates a new subscription in Asaas
 */
export async function createAsaasSubscription(
  planId: string,
  userId: string,
  customerId: string,
  paymentMethod: string,
): Promise<AsaasApiResponse<AsaasSubscriptionResponse>> {
  try {
    // For demo purposes, we'll simulate a successful API call
    await new Promise((resolve) => setTimeout(resolve, 1500))

    // Mock response data
    const subscriptionId = `sub_${Date.now()}`
    const paymentId = `pay_${Date.now()}`

    return {
      success: true,
      data: {
        subscriptionId,
        paymentId,
        status: "PENDING",
      },
    }
  } catch (error: any) {
    console.error("Error creating Asaas subscription:", error)
    return {
      success: false,
      message: error.message || "Failed to create subscription",
    }
  }
}

/**
 * Finds a payment in Asaas by ID
 */
export async function findAsaasPayment(
  paymentId: string,
  force = false,
): Promise<AsaasApiResponse<AsaasPaymentResponse>> {
  try {
    // For demo purposes, we'll simulate a successful API call
    await new Promise((resolve) => setTimeout(resolve, 500))

    // For demo purposes, we'll simulate a payment that gets confirmed after a few checks
    const now = Date.now()
    const paymentCreationTime = Number.parseInt(paymentId.split("_")[1])
    const secondsSinceCreation = (now - paymentCreationTime) / 1000

    // After 10 seconds, consider the payment received
    let status = "PENDING"
    if (secondsSinceCreation > 10) {
      status = "RECEIVED"
    }

    return {
      success: true,
      payment: {
        id: paymentId,
        status,
        value: 99.9,
        dueDate: new Date(now + 30 * 60 * 1000).toISOString(), // 30 minutes from now
        invoiceUrl: "https://example.com/invoice",
        billingType: "PIX",
      },
    }
  } catch (error: any) {
    console.error("Error finding Asaas payment:", error)
    return {
      success: false,
      message: error.message || "Failed to find payment",
    }
  }
}

/**
 * Gets a PIX QR code for a payment
 */
export async function getAsaasPixQrCode(paymentId: string): Promise<AsaasApiResponse<AsaasPixResponse>> {
  try {
    // For demo purposes, we'll simulate a successful API call
    await new Promise((resolve) => setTimeout(resolve, 1000))

    // Mock PIX QR code data
    // In a real app, this would be generated by Asaas\
    const mockQrCodeImage = "data:image/png;base64,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
